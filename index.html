<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÆX – Stroop Test</title>

<style>
    body {
        background: #0d0d0d;
        color: white;
        font-family: Arial, sans-serif;
        text-align: left;
        max-width: 850px;
        margin: 0 auto;
        padding: 60px 20px;
        line-height: 1.6;
    }

    h1 {
        text-align: center;
        font-size: 48px;
        margin-bottom: 50px;
    }

    #word {
        font-size: 80px;
        font-weight: bold;
        text-align: center;
        margin-top: 40px;
        margin-bottom: 40px;
        display: none;
    }

    .btn {
        font-size: 26px;
        padding: 16px 32px;
        margin: 10px;
        background: #1b1b1b;
        border: 2px solid #5fffd2;
        color: #5fffd2;
        cursor: pointer;
        border-radius: 8px;
    }

    .btn:hover {
        background: #5fffd2;
        color: #000;
    }

    #buttons {
        text-align: center;
        display: none;
    }

    #result {
        margin-top: 40px;
        font-size: 22px;
    }

    .badge {
        display: inline-block;
        padding: 12px 18px;
        background: #c0392b;
        color: white;
        font-weight: bold;
        border-radius: 6px;
        margin-top: 20px;
    }

    small {
        font-size: 12px;
        opacity: 0.7;
        display: block;
        margin-top: 50px;
        line-height: 1.4;
        text-align: center;
    }
</style>
</head>

<body>

<h1>Stroop Test</h1>

<div id="instructions">
    Premi “Inizia” per cominciare. Rispondi al <strong>colore dell’inchiostro</strong>, non alla parola.
</div>

<button id="startBtn" class="btn">Inizia</button>

<div id="word"></div>

<div id="buttons">
    <button class="btn" onclick="answer('red')">Rosso</button>
    <button class="btn" onclick="answer('green')">Verde</button>
    <button class="btn" onclick="answer('blue')">Blu</button>
    <button class="btn" onclick="answer('yellow')">Giallo</button>
</div>

<div id="result"></div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxjeGaCwJ6e3jRAZItuCur7F1hK1fv7TvRRpr8Bp1IhQqmp5Fdb_eI8GWAwia-fDN4X/exec";

let trials = [];
let currentTrial = 0;
let startTime = 0;

const words = ["RED", "GREEN", "BLUE", "YELLOW"];
const colors = ["red", "green", "blue", "yellow"];

document.getElementById("startBtn").onclick = () => {
    document.getElementById("instructions").style.display = "none";
    document.getElementById("startBtn").style.display = "none";
    document.getElementById("buttons").style.display = "block";
    nextTrial();
};

function nextTrial() {
    if (currentTrial >= 20) return finishTest();

    const word = words[Math.floor(Math.random() * words.length)];
    const correctColor = colors[Math.floor(Math.random() * colors.length)];
    const congruent = (word.toLowerCase() === correctColor);

    const wordDiv = document.getElementById("word");
    wordDiv.style.display = "block";
    wordDiv.innerHTML = word;
    wordDiv.style.color = correctColor;

    startTime = performance.now();

    trials.push({ word, correctColor, congruent, rt: null, correct: null });

    currentTrial++;
}

function answer(chosenColor) {
    let rt = Math.round(performance.now() - startTime);
    let trial = trials[currentTrial - 1];

    trial.rt = rt;
    trial.correct = (chosenColor === trial.correctColor);

    nextTrial();
}

function finishTest() {
    document.getElementById("buttons").style.display = "none";
    document.getElementById("word").style.display = "none";

    const meanRT_con = avg(trials.filter(t => t.congruent).map(t => t.rt));
    const meanRT_inc = avg(trials.filter(t => !t.congruent).map(t => t.rt));
    const stroopEffect = Math.round(meanRT_inc - meanRT_con);
    const accuracy = Math.round(
        (trials.filter(t => t.correct).length / trials.length) * 100
    );

    let profileText = "";
    if (stroopEffect > 200) profileText = "Carico attentivo elevato. possibili interferenze più forti";
    else if (stroopEffect > 120) profileText = "Interferenza moderata. controllo inibitorio nella norma";
    else profileText = "Ottimo controllo inibitorio. interferenze minime";

    document.getElementById("result").innerHTML = `
        <h2>Risultati</h2>

        <p><strong>Tempo medio prove congruenti.</strong> ${meanRT_con} ms</p>
        <p><strong>Tempo medio prove incongruenti.</strong> ${meanRT_inc} ms</p>
        <p><strong>Stroop Effect.</strong> ${stroopEffect} ms <small>(differenza tra incongruenti e congruenti)</small></p>
        <p><strong>Accuratezza risposte.</strong> ${accuracy} percent</p>

        <h3>Sintesi del tuo profilo in questo test</h3>
        <div class="badge">${profileText}</div>

        <h3>Come leggere questi dati</h3>
        <ul>
            <li>I tempi di reazione sono espressi in millisecondi. più basso è il valore, più veloce è la risposta.</li>
            <li>Lo Stroop Effect misura quanto le parole interferiscono con il colore. un valore più basso indica un miglior controllo inibitorio.</li>
            <li>Accuratezza sopra il 90 percent indica un buon equilibrio tra velocità e precisione.</li>
        </ul>

        <small>I dati di questo test sono salvati in forma anonima e aggregata. non raccogliamo nome, email o dati che permettano identificazione personale.<br>
        Il tuo codice di sessione è <strong>AEX-${Date.now()}</strong> e viene usato solo per analisi statistiche interne.</small>
    `;

    fetch(WEBAPP_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "text/plain" },
        body: JSON.stringify({
            sessionId: "AEX-" + Date.now(),
            rtCon: meanRT_con,
            rtInc: meanRT_inc,
            stroopEffect,
            accuracy,
            extra: ""
        })
    });
}

function avg(arr) {
    if (!arr.length) return 0;
    return Math.round(arr.reduce((a,b) => a + b, 0) / arr.length);
}
</script>

</body>
</html>
